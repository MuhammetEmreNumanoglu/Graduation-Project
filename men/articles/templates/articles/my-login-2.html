{% load crispy_forms_tags %}{% load static %}{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="{% static 'iyihisset.png' %}" type="image/png" />
    <!-- Preconnect to external domains for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <!-- External Stylesheets -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" crossorigin="anonymous" />
    <link rel="stylesheet" href="{% static 'css/global-font-size.css' %}">
    <title>{% trans "Psikolog Girişi" %}</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const validationMessages = {
          'required': '{% trans "Bu alan zorunludur." %}'
        };

        const form = document.querySelector('form');
        if (!form) {
          console.warn('[LOGIN] Form elementi bulunamadı!');
          return;
        }
        
        // Form validation setup - HTML5 required attribute'larını yönet
        function setupValidation() {
          const allInputs = form.querySelectorAll('input[type="text"], input[type="password"], input[type="email"]');
          allInputs.forEach(input => {
            input.addEventListener('invalid', function(e) {
              const errorMessage = e.target.validationMessage;
              for (const [key, value] of Object.entries(validationMessages)) {
                if (errorMessage.includes(key)) {
                  e.target.setCustomValidity(value);
                  break;
                }
              }
            });
            input.addEventListener('input', function(e) {
              e.target.setCustomValidity('');
            });
          });
        }
        
        setupValidation();
      });
    </script>
    <script>window.language_code = "{{ LANGUAGE_CODE }}";</script>
    <script src="{% static 'js/lang.js' %}"></script>
    <style>
      body {
        background: linear-gradient(135deg, #b993d6 0%, #8ca6db 100%);
        min-height: 100vh;
        margin: 0;
        padding: 0;
        font-family: 'Inter', sans-serif;
        transition: background 0.3s ease;
      }
      
      /* Dark mode styles */
      body.dark-mode {
        background: linear-gradient(135deg, #0f0f1a 0%, #0d1428 100%) !important;
        color: #f0f0f0 !important;
      }
      
      body.dark-mode .card {
        background: rgba(20, 20, 20, 0.95) !important;
        border-color: #333 !important;
        color: #f0f0f0 !important;
      }
      
      body.dark-mode .form-control {
        background: #1a1a1a !important;
        color: #f0f0f0 !important;
        border-color: #333 !important;
      }
      
      body.dark-mode .form-control:focus {
        background: #2a2a2a !important;
        border-color: #8b5cf6 !important;
        color: #f0f0f0 !important;
      }
      
      body.dark-mode .form-label {
        color: #f0f0f0 !important;
      }
      
      body.dark-mode .btn {
        background: linear-gradient(135deg, #8b46c1, #805ad5) !important;
        color: white !important;
        border-color: #6b46c1 !important;
      }
      
      body.dark-mode .btn:hover {
        background: linear-gradient(135deg, #7c3aed, #9333ea) !important;
        box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4) !important;
      }
      
      .container {
        background: transparent !important;
        border-radius: 0 !important;
        box-shadow: none !important;
        backdrop-filter: none !important;
        border: none !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* Light mode styles */
      .login-card {
        background: rgba(255, 255, 255, 0.95) !important;
        color: #232526 !important;
        border: 1px solid #e0e0e0 !important;
      }
      
      .login-card .text-center a {
        color: #6a4c9c !important;
      }
      
      .login-card .text-center a:hover {
        color: #8b5cf6 !important;
      }
      
      /* Dark mode styles */
      body.dark-mode .login-card {
        background: rgba(30, 30, 30, 0.95) !important;
        color: #f0f0f0 !important;
        border: 1px solid #444 !important;
      }
      
      body.dark-mode .login-card .text-center a {
        color: #8b5cf6 !important;
      }
      
      .form-control {
        border-radius: 12px !important;
        border: 2px solid #e2e8f0 !important;
        padding: 12px 16px !important;
        transition: all 0.3s ease !important;
      }
      
      .form-control:focus {
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 0 0.2rem rgba(139, 92, 246, 0.25) !important;
      }
      
      .alert {
        border-radius: 12px !important;
        border: none !important;
      }
      
      .alert-danger {
        background: linear-gradient(135deg, #dc3545, #c82333) !important;
        color: white !important;
      }
      
      .alert-success {
        background: linear-gradient(135deg, #28a745, #20c997) !important;
        color: white !important;
      }
      
      .text-center a {
        color: #8b5cf6 !important;
        text-decoration: none !important;
        font-weight: 600 !important;
        transition: color 0.3s ease !important;
      }
      
      .text-center a:hover {
        color: #a855f7 !important;
      }
      
      .popup-message {
        position: absolute;
        top: 24px;
        right: 32px;
        z-index: 2000;
        min-width: 220px;
        max-width: 350px;
        padding: 16px 32px;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.13);
        font-size: 1.1rem;
        opacity: 1;
        transition: opacity 0.5s;
      }
      .popup-message.hide {
        opacity: 0;
        pointer-events: none;
      }
      
      .form-check-label {
        color: #232526 !important;
        font-weight: 500;
        cursor: pointer;
      }
      
      .form-check-input {
        cursor: pointer;
        width: 1.2em;
        height: 1.2em;
        border: 2px solid #8b5cf6 !important;
      }
      
      .form-check-input:checked {
        background-color: #8b5cf6 !important;
        border-color: #8b5cf6 !important;
      }
      
      body.dark-mode .form-check-label {
        color: #f0f0f0 !important;
      }
    </style>
      <link rel="stylesheet" href="{% static 'css/global-responsive.css' %}" />
  </head>

  <body class="login-page">

    <div class="container p-5">
      {% for message in messages %}
        {% if message.level == 25 %}
          <div id="message" class="alert alert-success popup-message">{{ message }}</div>
        {% elif message.level >= 30 %}
          <div id="error-message" class="alert alert-danger popup-message">{{ message }}</div>
        {% endif %}
      {% endfor %}
      <div class="row justify-content-center">
        <div class="col-md-6 shadow-lg p-5 rounded-5 login-card">
          <div class="d-flex justify-content-center align-items-center mb-4" style="gap: 16px;">
            <img src="{% static 'iyihisset.png' %}" class="logo-soft" alt="İyi Hisset Logo" style="height: 60px;">
            <span style="font-size: 2rem; font-weight: bold; color: #5a5a99;">İyi Hisset</span>
          </div>
          
          <h3 class="text-center mb-4" style="color: #5a5a99;">{% trans "Psikolog Girişi" %}</h3>

          <br />

          <form method="POST" id="loginForm" novalidate>
            {% csrf_token %}
            <div id="psychologistLoginForm">
              <div class="form-group mb-3">
                <label for="id_username" class="form-label">{{ LoginForm.username.label }}</label>
                {{ LoginForm.username }}
                {% if LoginForm.username.errors %}
                  <div class="text-danger small">{{ LoginForm.username.errors }}</div>
                {% endif %}
              </div>
              <div class="form-group mb-3">
                <label for="id_password" class="form-label">{{ LoginForm.password.label }}</label>
                {{ LoginForm.password }}
                {% if LoginForm.password.errors %}
                  <div class="text-danger small">{{ LoginForm.password.errors }}</div>
                {% endif %}
              </div>
              <div class="form-check mb-3">
                {{ LoginForm.remember_me }}
                <label class="form-check-label" for="id_remember_me">
                  {{ LoginForm.remember_me.label }}
                </label>
                {% if LoginForm.remember_me.errors %}
                  <div class="text-danger small">{{ LoginForm.remember_me.errors }}</div>
                {% endif %}
              </div>
              {% if LoginForm.non_field_errors %}
                <div class="alert alert-danger">
                  {% for error in LoginForm.non_field_errors %}
                    <div>{{ error }}</div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <br />
            <div class="d-flex justify-content-center">
              <button class="btn btn-secondary rounded-5 w-50" type="submit">
                <span class="fs-5">{% trans "Giriş Yap" %}</span>
              </button>
            </div>
          </form>
          <br />
          <div class="text-center">
            <a href="{% url 'my-login' %}">{% trans "Üye Girişi" %}</a>
          </div>
        </div>
      </div>
    </div>

    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/font-size-manager.js' %}"></script>
    <script>
      function applyThemeFromStorage() {
        const theme = localStorage.getItem('themeMode') || 'light';
        if(theme === 'dark') {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
        }
      }
      
      document.addEventListener('DOMContentLoaded', function() {
        applyThemeFromStorage();
        
        if (typeof initializeLanguage === 'function') {
          initializeLanguage();
        }
        
        var msg = document.getElementById('message');
        if (msg && msg.classList) {
          setTimeout(function() {
            if (msg && msg.classList) msg.classList.add('hide');
          }, 5000);
        }
        var errorMsg = document.getElementById('error-message');
        if (errorMsg) {
          setTimeout(function() {
            if (errorMsg && errorMsg.classList) errorMsg.classList.add('hide');
          }, 5000);
        }
        
        // Sayfa yüklendiğinde input'lardan required attribute'unu kaldır
        setTimeout(function() {
          const psychologistLoginForm = document.getElementById('psychologistLoginForm');
          if (psychologistLoginForm) {
            const inputs = psychologistLoginForm.querySelectorAll('input');
            inputs.forEach(input => {
              input.removeAttribute('required');
              input.setCustomValidity('');
            });
          }
        }, 100);
      });
    </script>
  </body>
</html>

