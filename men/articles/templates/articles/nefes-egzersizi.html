{% load static %} {% load i18n %}
<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nefes Egzersizi</title>
    <link rel="icon" href="{% static 'iyihisset.png' %}" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link rel="stylesheet" href="{% static 'css/responsive-sidebar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/global-font-size.css' %}" />
    <style>
      :root {
        --primary-color: #6c3eb4; /* Derin Mor */
        --secondary-color: #8ca6db; /* Açık Mavi-Mor */
        --accent-color: #b993d6; /* Lila */
        --background-light: #f9f9f9;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
        --border-radius: 20px;
        --transition-smooth: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        --lila-color: #b993d6;
        --purple-ball: #6c3eb4;
        --path-stroke-width: 18px; /* Çubukların kalınlığı, belirginleşti */
        --ball-size: 32px; /* Topun boyutu, belirginleşti */
      }

      body {
        background: linear-gradient(
          135deg,
          #b993d6 0%,
          #8ca6db 100%
        ) !important;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        font-family: "Inter", sans-serif;
        overflow-x: hidden;
        overflow-y: auto;
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: var(--transition-smooth);
        padding: 32px;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .breathing-container {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.98),
          rgba(255, 255, 255, 0.95)
        );
        border-radius: 28px;
        padding: 60px;
        box-shadow: 0 16px 50px rgba(0, 0, 0, 0.15);
        text-align: center;
        max-width: 750px;
        width: 100%;
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      .breathing-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        border-radius: 28px 28px 0 0;
      }

      .breathing-visualizer-wrapper {
        position: relative; /* Top ve metin için ana kapsayıcı */
        width: 100%;
        max-width: 550px; /* SVG genişliğine göre ayarla */
        height: 200px; /* SVG yüksekliğine göre ayarla */
        margin: 0 auto 30px; /* Metni altına almak için boşluk */
        display: flex;
        justify-content: center;
        align-items: center;
      }

      svg {
        overflow: visible; /* Topun path dışına taşması için */
        position: absolute; /* Wrapper içinde pozisyonunu kontrol etmek için */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      .breathing-path {
        stroke: var(--accent-color); /* Yolun varsayılan rengi */
        stroke-width: var(--path-stroke-width);
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
        opacity: 0.7;
        transition: stroke 0.4s ease-in-out, opacity 0.4s ease-in-out,
          filter 0.4s ease-in-out;
        filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.1));
      }

      /* Topun kendisi */
      .breathing-ball {
        position: absolute;
        width: var(--ball-size);
        height: var(--ball-size);
        background: radial-gradient(
          circle at 30% 30%,
          #ffffff,
          #f0f0f0 70%,
          var(--primary-color) 100%
        );
        border-radius: 50%;
        box-shadow: 0 0 15px rgba(255, 255, 255, 1),
          0 0 30px var(--accent-color); /* Daha belirgin parlama */
        transform: translate(-50%, -50%); /* Kendi merkezine göre hizala */
        z-index: 2; /* Yolun üzerinde görünmesi için */
        transition: transform 0.01s linear; /* Çok hızlı hareket güncellemeleri için */
      }

      .breathing-text-display {
        /* Metni görselleştiricinin altına aldık */
        font-size: 2.2rem;
        font-weight: 700;
        font-family: "Playfair Display", serif;
        color: var(--primary-color);
        margin-top: 20px; /* Görselleştiriciden boşluk */
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: opacity 0.3s ease, transform 0.3s ease;
        min-height: 40px; /* Yükseklik sabitleme */
      }
      
      .motivational-message {
        font-size: 1.4rem;
        font-weight: 600;
        font-family: "Inter", sans-serif;
        color: var(--accent-color);
        margin: 20px 0;
        text-align: center;
        min-height: 30px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.5s ease;
      }
      
      .motivational-message.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* Start/Stop Buttons */
      .breathing-controls {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 40px;
        flex-wrap: wrap;
      }

      .breathing-btn {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 15px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.4s ease-in-out;
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .breathing-btn:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 10px 28px rgba(139, 92, 246, 0.55);
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--primary-color)
        );
      }

      .breathing-btn.secondary {
        background: linear-gradient(135deg, #a788d6, #7a5bb0);
        box-shadow: 0 4px 16px rgba(122, 91, 176, 0.3);
      }

      .breathing-btn.secondary:hover {
        background: linear-gradient(135deg, #7a5bb0, #a788d6);
        box-shadow: 0 6px 20px rgba(122, 91, 176, 0.4);
      }

      .breathing-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .breathing-title {
        font-family: "Playfair Display", serif;
        font-size: 3.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        text-shadow: 0 4px 8px rgba(108, 62, 180, 0.2);
      }

      .breathing-subtitle {
        font-size: 1.3rem;
        color: var(--text-secondary);
        margin-bottom: 4rem;
        line-height: 1.7;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Responsive Design */
      @media (max-width: 991px) {
        .main-content {
          margin-left: 0;
        }
      }

      @media (max-width: 768px) {
        .breathing-container {
          padding: 40px 24px;
        }
        .breathing-title {
          font-size: 2.8rem;
        }
        .breathing-subtitle {
          font-size: 1.1rem;
          margin-bottom: 3rem;
        }
        .breathing-visualizer-wrapper {
          height: 150px;
          max-width: 450px;
        }
        .breathing-text-display {
          font-size: 1.8rem;
          margin-top: 15px;
        }
        .breathing-btn {
          padding: 12px 24px;
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .breathing-container {
          padding: 30px 16px;
          margin: 15px;
        }
        .breathing-title {
          font-size: 2.2rem;
        }
        .breathing-subtitle {
          font-size: 1rem;
          margin-bottom: 2rem;
        }
        .breathing-visualizer-wrapper {
          height: 100px;
          max-width: 350px;
        }
        .breathing-text-display {
          font-size: 1.5rem;
          margin-top: 10px;
        }
        .breathing-controls {
          flex-direction: column;
          gap: 12px;
        }
        .breathing-btn {
          width: 100%;
          max-width: 250px;
        }
      }

      .breathing-settings {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 32px;
        background: rgba(245, 245, 255, 0.7);
        border-radius: 16px;
        box-shadow: 0 2px 12px rgba(108, 62, 180, 0.06);
        padding: 18px 18px 6px 18px;
        border: 1px solid #ece6fa;
      }

      .setting-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 110px;
        gap: 8px;
      }

      .breathing-settings label {
        font-weight: 500;
        font-size: 1rem;
        color: var(--primary-color);
        margin-bottom: 0;
        display: block;
        text-align: center;
      }

      .number-input-wrapper {
        display: flex;
        align-items: center;
        background: #f7f5ff;
        border: 1.5px solid #d1c4e9;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 4px rgba(108, 62, 180, 0.04);
        transition: all 0.3s ease;
      }

      .number-input-wrapper:focus-within {
        border-color: var(--primary-color);
        box-shadow: 0 2px 8px rgba(108, 62, 180, 0.1);
        background: #fff;
      }

      .number-btn {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: white;
        border: none;
        width: 28px;
        height: 28px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
      }

      .number-btn:hover {
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--primary-color)
        );
        transform: scale(1.05);
      }

      .number-btn:active {
        transform: scale(0.95);
      }

      .number-btn:disabled {
        background: #e0e0e0;
        color: #999;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .number-btn:disabled:hover {
        background: #e0e0e0;
        transform: none;
      }

      .number-input {
        width: 50px;
        padding: 4px 6px;
        border: none;
        font-size: 1rem;
        font-weight: 500;
        text-align: center;
        background: transparent;
        color: var(--primary-color);
        outline: none;
      }

      .number-input::-webkit-outer-spin-button,
      .number-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      @media (max-width: 600px) {
        .breathing-settings {
          flex-direction: column;
          gap: 8px;
          padding: 10px 8px 2px 8px;
        }
        .breathing-settings > div {
          min-width: 90px;
        }
      }
      #cycleCounter {
        position: fixed;
        right: 36px;
        bottom: 36px;
        z-index: 1000;
        background: linear-gradient(135deg, #f7f5ff 0%, #ece6fa 100%);
        box-shadow: 0 2px 12px rgba(108, 62, 180, 0.1);
        border-radius: 16px;
        padding: 16px 28px;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
        display: none;
        border: 1.5px solid #ece6fa;
        transition: box-shadow 0.2s, background 0.2s;
      }
      #cycleCounter:hover {
        box-shadow: 0 6px 24px rgba(108, 62, 180, 0.18);
        background: linear-gradient(135deg, #ece6fa 0%, #f7f5ff 100%);
      }
      @media (max-width: 600px) {
        #cycleCounter {
          right: 10px;
          bottom: 10px;
          padding: 10px 14px;
          font-size: 1rem;
        }
      }
      body.iyi-dark {
        background: #181818 !important;
        color: #e0e0e0 !important;
      }
      body.iyi-dark .main-content,
      body.iyi-dark .content-section,
      body.iyi-dark .card,
      body.iyi-dark .box,
      body.iyi-dark .panel {
        background: #232323 !important;
        color: #e0e0e0 !important;
        border-color: #333 !important;
      }
      body.iyi-dark a {
        color: #9ecbff !important;
      }
      body.iyi-dark .btn {
        background: #333 !important;
        color: #fff !important;
      }
      body.iyi-dark input,
      body.iyi-dark textarea,
      body.iyi-dark select {
        background: #232323 !important;
        color: #e0e0e0 !important;
        border-color: #444 !important;
      }

      .sidebar-block.sidebar-title {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        padding: 24px;
        margin-bottom: 0;
        flex: 1 1 auto;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        height: 100vh;
        max-height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .sidebar-title-text {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 18px;
        width: 100%;
        text-align: left;
        position: relative;
      }
      .sidebar-title-text::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 40px;
        height: 3px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 2px;
      }
      .sidebar-tasks {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        min-height: 0;
      }
      .sidebar-task-item {
        background: rgba(139, 92, 246, 0.1);
        border-radius: 12px;
        padding: 16px;
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 500;
        box-shadow: 0 1px 4px rgba(140, 82, 255, 0.04);
        border: 1px solid transparent;
        transition: var(--transition-smooth);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .sidebar-task-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }
      .sidebar-task-item:hover {
        background: rgba(139, 92, 246, 0.15);
        box-shadow: 0 2px 8px rgba(140, 82, 255, 0.09);
        border-color: rgba(139, 92, 246, 0.2);
        transform: translateX(4px);
      }
      .sidebar-task-item:hover::before {
        left: 100%;
      }
      .sidebar-container {
        width: 400px;
        min-width: 400px;
        max-width: 400px;
        flex-shrink: 0;
        z-index: 2;
        background: #fff;
      }
      .sidebar-menu {
        flex: 1 1 auto;
        min-height: 0;
        display: flex;
        flex-direction: column;
      }
      body.dark-mode {
        background: #181818 !important;
        color: #e0e0e0 !important;
      }

      /* Sidebar dark mode */
      body.dark-mode .sidebar-container {
        background: #1a1a1a !important;
        border-color: #333 !important;
      }

      

      body.dark-mode .sidebar-nav a {
        background: #333 !important;
        color: #e0e0e0 !important;
      }

      body.dark-mode .sidebar-nav a:hover {
        background: #4a4a4a !important;
        color: #fff !important;
      }

      body.dark-mode .sidebar-nav a.active {
        background: var(--primary-color) !important;
        color: white !important;
      }

      body.dark-mode .sidebar-user {
        background: #181818 !important;
        border-color: #333 !important;
      }

      body.dark-mode .user-info h3 {
        color: #e0e0e0 !important;
      }

              body.dark-mode .user-info p {
          color: #b0b0b0 !important;
          font-size: 0.9rem !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
          max-width: 200px !important;
        }

      body.dark-mode .sidebar-task-item {
        background: #333 !important;
        color: #e0e0e0 !important;
        border-color: #444 !important;
      }

      body.dark-mode .sidebar-task-item:hover {
        background: #444 !important;
        color: #fff !important;
        border-color: var(--primary-color) !important;
      }

      body.dark-mode .main-content,
      body.dark-mode .content-section,
      body.dark-mode .card,
      body.dark-mode .box,
      body.dark-mode .panel {
        background: #232323 !important;
        color: #e0e0e0 !important;
        border-color: #333 !important;
      }

      body.dark-mode a {
        color: var(--primary-color) !important;
      }
      body.dark-mode .btn {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        ) !important;
        color: #e0e0e0 !important;
      }

      body.dark-mode .breathing-container,
      body.iyi-dark .breathing-container {
        background: linear-gradient(135deg, #23232c 96%, #25213d 100%);
        color: #e0e0e0 !important;
        border-color: #222 !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      }

      body.dark-mode .breathing-title,
      body.iyi-dark .breathing-title {
        color: #a88fff;
      }

      body.dark-mode .breathing-subtitle,
      body.iyi-dark .breathing-subtitle {
        color: #b0b0b0;
      }

      body.dark-mode .breathing-settings,
      body.iyi-dark .breathing-settings {
        background: #1a182a;
        border-color: #29233f;
      }

      body.dark-mode .breathing-path,
      body.iyi-dark .breathing-path {
        stroke: #7659bf !important;
      }
      body.dark-mode .sidebar-block.sidebar-title,
      body.iyi-dark .sidebar-block.sidebar-title {
        background: #181818 !important;
        color: #eee !important;
        border-color: #25213d !important;
      }

      body.dark-mode .sidebar-title-text,
      body.iyi-dark .sidebar-title-text {
        color: #b993d6;
      }

      @media (max-width: 991px) {
        .sidebar-container {
          width: 100vw;
          min-width: 0;
          max-width: 100vw;
        }
        .main-content {
          margin-left: 0;
          padding-top: 80px;
        }
      }

      .notification-bell {
        position: fixed;
        top: 32px;
        right: 48px;
        z-index: 1200;
        background: linear-gradient(135deg, #a084e8 0%, #6c3eb4 100%);
        border-radius: 50%;
        padding: 12px;
        border: none;
        cursor: pointer;
        font-size: 2.2rem;
        color: #fff;
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.13);
        transition: color 0.2s, background 0.2s, box-shadow 0.2s,
          transform 0.18s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .notification-bell:hover {
        transform: scale(1.08);
      }
      .notification-popup {
        display: block;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        position: fixed;
        top: 72px;
        right: 48px;
        width: 340px;
        max-height: 270px;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.18);
        border: 1.5px solid #ece6fa;
        z-index: 1300;
        overflow-y: auto;
        padding: 0;
        transform: translateY(-20px);
        transition: opacity 0.35s cubic-bezier(0.4, 0, 0.2, 1),
          transform 0.35s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.35s;
      }
      .notification-popup.active {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateY(0);
      }
      .notification-popup .popup-title {
        font-weight: 700;
        font-size: 1.2rem;
        padding: 18px 24px 8px 24px;
        color: #8b5cf6;
        border-bottom: 1px solid #ece6fa;
      }
      .notification-list {
        list-style: none;
        margin: 0;
        padding: 0 0 8px 0;
        max-height: 340px;
        overflow-y: auto;
      }
      .notification-item {
        padding: 16px 24px;
        border-bottom: 1px solid #f3eaff;
        font-size: 1rem;
        color: #232526;
        background: none;
      }
      .notification-item:last-child {
        border-bottom: none;
      }
      @media (max-width: 600px) {
        .notification-bell {
          top: 16px;
          right: 12px;
          padding: 8px;
          font-size: 1.5rem;
        }
        .notification-popup {
          top: 48px;
          right: 8px;
          width: 95vw;
          min-width: 0;
          max-width: 98vw;
        }
      }
      /* Dark mode için */
      body.dark-mode .notification-bell {
        background: linear-gradient(
          135deg,
          #6c3eb4 0%,
          #3a2a5d 100%
        ) !important;
        color: #fff !important;
        box-shadow: 0 8px 32px rgba(80, 60, 120, 0.32);
      }
      body.dark-mode .notification-bell:hover {
        background: linear-gradient(
          135deg,
          #6c3eb4 0%,
          #3a2a5d 100%
        ) !important;
        color: #fff !important;
        box-shadow: 0 8px 32px rgba(80, 60, 120, 0.32);
      }
      body.dark-mode .notification-popup {
        background: #232323 !important;
        color: #e0e0e0 !important;
        border-color: #333 !important;
      }
      body.dark-mode .notification-popup .popup-title {
        color: #c084fc !important;
        border-bottom: 1px solid #333 !important;
      }
      body.dark-mode .notification-item {
        color: #e0e0e0 !important;
        border-bottom: 1px solid #333 !important;
      }

      .dashboard-user-avatar {
        
      }

      .user-avatar img {
        
      }
      /* Dark Mode — meditasyon ile aynı (override) */
      body.dark-mode { background: #181818 !important; color: #e0e0e0 !important; }
      body.dark-mode .main-content { background: #232323 !important; color: #e0e0e0 !important; }
      body.dark-mode .page-title { color: #e0e0e0 !important; }
      body.dark-mode .page-subtitle { color: #b0b0b0 !important; }
      body.dark-mode .sidebar-container { background: #1a1a1a !important; border-color: #333 !important; }
      body.dark-mode .sidebar-header { background: #181818 !important; border-color: #333 !important; }
      body.dark-mode .sidebar-nav a { background: #333 !important; color: #e0e0e0 !important; }
      body.dark-mode .sidebar-nav a:hover { background: #4a4a4a !important; color: #fff !important; }
      body.dark-mode .sidebar-nav a.active { background: var(--primary-color) !important; color: #fff !important; }
      body.dark-mode .sidebar-block.sidebar-title { background: #181818 !important; color: #f8f8ff !important; border-color: #29293a !important; }
      body.dark-mode .sidebar-block.sidebar-title * { color: #f8f8ff !important; }
      body.dark-mode .sidebar-user { background: #181818 !important; border-color: #333 !important; }
      body.dark-mode .user-info h3 { color: #e0e0e0 !important; }
              body.dark-mode .user-info p { 
          color: #b0b0b0 !important; 
          font-size: 0.9rem !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
          max-width: 200px !important;
        }
      body.dark-mode .sidebar-task-item { background: #333 !important; color: #e0e0e0 !important; border-color: #444 !important; }
      body.dark-mode .sidebar-task-item:hover { background: #444 !important; color: #fff !important; border-color: var(--primary-color) !important; }
      body.dark-mode .sidebar-title-text { color: var(--primary-color) !important; }
      body.dark-mode .menu-item { color: #e0e0e0 !important; }
      body.dark-mode .menu-item:hover { background: #333 !important; color: var(--primary-color) !important; }
      body.dark-mode .menu-item.active { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important; color: #fff !important; }

      /* Ensure dark mode main content background */
      body.dark-mode .main-content { background: #23232354 !important; }
    </style>
  </head>
  <body>
    <div class="sidebar-container" id="sidebarContainer">
      <div class="sidebar-header">
        <img src="{% static 'iyihisset.png' %}" alt="Logo" class="sidebar-logo"/>
        <div class="sidebar-nav">
          <a href="{% url 'anasayfa' %}">{% trans "Ana Sayfa" %}</a>
          <a href="{% url 'dashboard' %}">{% trans "İyi Hisset" %}</a>
          <a href="{% url 'profile-management' %}">{% trans "Profil Yönetimi" %}</a>
        </div>
      </div>
      <div class="sidebar-user">
        <div class="user-avatar">
          <img src="{{profilePic.profile_pic.url}}" alt="" />
        </div>
        <div class="user-info">
          <h3>{{ user.username.title }}</h3>
          <p>{{ user.email }}</p>
        </div>
      </div>
      <div class="sidebar-menu">
        {% include 'articles/gorevlerim.html' %}
      </div>
    </div>

    <main class="main-content">
      <div class="breathing-container">
        <div class="breathing-settings">
          <div class="setting-group">
            <label for="inhaleDuration">{% trans "Nefes Al (sn)" %}</label>
            <div class="number-input-wrapper">
              <button class="number-btn minus" data-target="inhaleDuration">-</button>
              <input type="number" id="inhaleDuration" min="1" max="30" value="4" class="number-input" />
              <button class="number-btn plus" data-target="inhaleDuration">+</button>
            </div>
          </div>
          <div class="setting-group">
            <label for="holdDuration">{% trans "Tut (sn)" %}</label>
            <div class="number-input-wrapper">
              <button class="number-btn minus" data-target="holdDuration">-</button>
              <input type="number" id="holdDuration" min="0" max="30" value="7" class="number-input" />
              <button class="number-btn plus" data-target="holdDuration">+</button>
            </div>
          </div>
          <div class="setting-group">
            <label for="exhaleDuration">{% trans "Nefes Ver (sn)" %}</label>
            <div class="number-input-wrapper">
              <button class="number-btn minus" data-target="exhaleDuration">-</button>
              <input type="number" id="exhaleDuration" min="1" max="30" value="8" class="number-input" />
              <button class="number-btn plus" data-target="exhaleDuration">+</button>
            </div>
          </div>
          <div class="setting-group">
            <label for="cycleCount">{% trans "Tekrar" %}</label>
            <div class="number-input-wrapper">
              <button class="number-btn minus" data-target="cycleCount">-</button>
              <input type="number" id="cycleCount" min="1" max="99" value="5" class="number-input" />
              <button class="number-btn plus" data-target="cycleCount">+</button>
            </div>
          </div>
        </div>
        <h1 class="breathing-title">{% trans "Nefes Egzersizi" %}</h1>
        <p class="breathing-subtitle">{% trans "Sakinleşmek ve zihninizi dinginleştirmek için ritmik nefes alışverişinizi takip edin." %}</p>

        <div class="breathing-visualizer-wrapper">
          <svg width="550" height="200" viewBox="0 0 550 200" preserveAspectRatio="xMidYMid meet">
            <path id="fullPath" fill="none" stroke="none" d="M 50 150 L 220 50 L 380 50 L 500 150" />
            <path id="pathInhale" class="breathing-path" d="M 50 150 L 220 50" />
            <path id="pathHold" class="breathing-path" d="M 220 50 L 380 50" />
            <path id="pathExhale" class="breathing-path" d="M 380 50 L 500 150" />
          </svg>
          <div class="breathing-ball" id="breathingBall"></div>
        </div>

        <div class="breathing-text-display" id="breathingText">{% trans "Hazır" %}</div>
        
        <div class="motivational-message" id="motivationalMessage"></div>

        <div class="breathing-controls">
          <button class="breathing-btn" id="startBtn">{% trans "Başla" %}</button>
          <button class="breathing-btn secondary" id="stopBtn" style="display: none">{% trans "Durdur" %}</button>
        </div>
        <div id="cycleCounter" style="position: absolute; right: 24px; bottom: 24px; z-index: 10; display: none;">
          {% trans "Döngü:" %} <span id="cycleCurrent">0</span>/<span id="cycleTotal">5</span>
        </div>
      </div>
    </main>

    {% include 'articles/includes/notifications.html' %}

    <!-- JS DOSYALARI -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/app.js' %}"></script>
    <script src="{% static 'js/responsive-sidebar.js' %}"></script>
    <script src="{% static 'js/font-size-manager.js' %}"></script>
    <script src="{% static 'js/lang.js' %}"></script>
    <script>
      // ---- Nefes Egzersizi ANİMASYONU ----
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");
      const breathingVisualizerWrapper = document.querySelector(".breathing-visualizer-wrapper");
      const breathingText = document.getElementById("breathingText");
      const breathingBall = document.getElementById("breathingBall");
      const pathInhale = document.getElementById("pathInhale");
      const pathHold = document.getElementById("pathHold");
      const pathExhale = document.getElementById("pathExhale");
      let isRunning = false;
      let animationFrameId;
      let phaseStartTimestamp;
      let currentPhaseIndex = 0;
      let cycleTotal = 5;
      let cycleCurrent = 0;
      let phaseDefs = [
        { name: "{% trans 'Nefes Al' %}", path: pathInhale, duration: 4000 },
        { name: "{% trans 'Tut' %}", path: pathHold, duration: 7000 },
        { name: "{% trans 'Nefes Ver' %}", path: pathExhale, duration: 8000 },
      ];
      
      // Motive edici cümleler
      const motivationalMessages = {
        tr: [
          "{% trans 'Great! You completed the breathing exercise!' %}",
          "{% trans 'Perfect! You took good care of yourself!' %}",
          "{% trans 'Super! You should feel relaxed!' %}",
          "{% trans 'Well done! You made time for yourself today!' %}",
          "{% trans 'Excellent! Your breath control is improving!' %}"
        ],
        en: [
          "Great! You completed the breathing exercise!",
          "Perfect! You took good care of yourself!",
          "Super! You should feel relaxed!",
          "Well done! You made time for yourself today!",
          "Excellent! Your breath control is improving!"
        ]
      };
      let phasePaths = [];
      function updateDurationsFromInputs() {
        const inhale = parseInt(document.getElementById("inhaleDuration")?.value) || 4;
        const hold = parseInt(document.getElementById("holdDuration")?.value) || 7;
        const exhale = parseInt(document.getElementById("exhaleDuration")?.value) || 8;
        phaseDefs[0].duration = inhale * 1000;
        phaseDefs[1].duration = hold * 1000;
        phaseDefs[2].duration = exhale * 1000;
        cycleTotal = parseInt(document.getElementById("cycleCount")?.value) || 5;
        const cycleTotalElement = document.getElementById("cycleTotal");
        if (cycleTotalElement) cycleTotalElement.textContent = cycleTotal;
        preparePhasePaths();
      }
      function preparePhasePaths() {
        phasePaths = [
          { path: pathInhale, start: 0, end: pathInhale.getTotalLength() },
          { path: pathHold, start: 0, end: pathHold.getTotalLength() },
          { path: pathExhale, start: 0, end: pathExhale.getTotalLength() },
        ];
      }
      function setBallPositionOnPath(pathElement, progress) {
        if (!pathElement || !breathingBall || !breathingVisualizerWrapper) return;
        const pathLength = pathElement.getTotalLength();
        const length = Math.max(0, Math.min(pathLength, pathLength * progress));
        const point = pathElement.getPointAtLength(length);
        const svg = pathElement.closest("svg");
        const wrapperRect = breathingVisualizerWrapper.getBoundingClientRect();
        const scaleX = wrapperRect.width / svg.viewBox.baseVal.width;
        const scaleY = wrapperRect.height / svg.viewBox.baseVal.height;
        const adjustedX = point.x * scaleX;
        const adjustedY = point.y * scaleY;
        breathingBall.style.left = `${adjustedX}px`;
        breathingBall.style.top = `${adjustedY}px`;
      }
      function resetCycleCounter() {
        cycleCurrent = 0;
        const cycleCurrentElement = document.getElementById("cycleCurrent");
        if (cycleCurrentElement) {
          cycleCurrentElement.textContent = cycleCurrent;
        }
      }
      function showCycleCounter(show = true) {
        const cycleCounterElement = document.getElementById("cycleCounter");
        if (cycleCounterElement) {
          cycleCounterElement.style.display = show ? "block" : "none";
        }
      }
      
      function showMotivationalMessage() {
        const messageElement = document.getElementById("motivationalMessage");
        if (!messageElement) return;
        
        const currentLang = localStorage.getItem('selectedLanguage') || 'tr';
        const messages = motivationalMessages[currentLang] || motivationalMessages.tr;
        const randomMessage = messages[Math.floor(Math.random() * messages.length)];
        
        messageElement.textContent = randomMessage;
        messageElement.classList.add('show');
        
        // 5 saniye sonra mesajı gizle
        setTimeout(() => {
          messageElement.classList.remove('show');
        }, 5000);
      }
      function updateBreathingText(text, isReady = false) {
        breathingText.textContent = text;
        breathingText.style.color = isReady ? "var(--primary-color)" : "var(--accent-color)";
      }
      function highlightCurrentPhase(idx) {
        phaseDefs.forEach((p, i) => {
          if (!p.path) return;
          if (i === idx) {
            p.path.style.stroke = "var(--primary-color)";
            p.path.style.opacity = "1";
            p.path.style.filter = "drop-shadow(0 0 10px var(--accent-color))";
          } else {
            p.path.style.stroke = "var(--accent-color)";
            p.path.style.opacity = "0.7";
            p.path.style.filter = "none";
          }
        });
      }
      function stopBreathing() {
        isRunning = false;
        cancelAnimationFrame(animationFrameId);
        if (startBtn) startBtn.style.display = "inline-block";
        if (stopBtn) stopBtn.style.display = "none";
        showCycleCounter(false);
        highlightCurrentPhase(-1);
        setBallPositionOnPath(phaseDefs[0].path, 0);
        updateBreathingText("{% trans 'Hazır' %}", true);
        
        // Egzersiz bittiğinde motive edici cümle göster
        if (cycleCurrent >= cycleTotal) {
          showMotivationalMessage();
        }
      }
      function animatePhase() {
        if (!isRunning) return;
        const now = performance.now();
        const phaseDef = phaseDefs[currentPhaseIndex];
        const elapsed = now - phaseStartTimestamp;
        const duration = phaseDef.duration;
        if (elapsed >= duration) {
          setBallPositionOnPath(phaseDef.path, 1);
          currentPhaseIndex++;
          if (currentPhaseIndex >= phaseDefs.length) {
            cycleCurrent++;
            const cycleCurrentElement = document.getElementById("cycleCurrent");
            if (cycleCurrentElement) {
              cycleCurrentElement.textContent = cycleCurrent;
            }
            if (cycleCurrent >= cycleTotal) {
              updateBreathingText("{% trans 'Tebrikler!' %}");
              showCycleCounter(false);
              stopBreathing();
              return;
            }
            currentPhaseIndex = 0;
          }
          highlightCurrentPhase(currentPhaseIndex);
          phaseStartTimestamp = now;
          animatePhase();
          return;
        }
        const progress = elapsed / duration;
        setBallPositionOnPath(phaseDef.path, progress);
        const remainingTime = Math.max(0, Math.ceil((duration - elapsed) / 1000));
        updateBreathingText(`${phaseDef.name} (${remainingTime}s)`);
        highlightCurrentPhase(currentPhaseIndex);
        animationFrameId = requestAnimationFrame(animatePhase);
      }
      function startBreathing() {
        updateDurationsFromInputs();
        resetCycleCounter();
        showCycleCounter(true);
        if (isRunning) return;
        isRunning = true;
        if (startBtn) startBtn.style.display = "none";
        if (stopBtn) stopBtn.style.display = "inline-block";
        currentPhaseIndex = 0;
        phaseStartTimestamp = performance.now();
        highlightCurrentPhase(currentPhaseIndex);
        requestAnimationFrame(animatePhase);
      }
      if (startBtn) startBtn.addEventListener("click", startBreathing);
      if (stopBtn) stopBtn.addEventListener("click", stopBreathing);
      ["inhaleDuration", "holdDuration", "exhaleDuration", "cycleCount"].forEach((id) => {
        const element = document.getElementById(id);
        if (element) {
          element.addEventListener("change", () => {
            updateDurationsFromInputs();
            resetCycleCounter();
            const cycleTotalElement = document.getElementById("cycleTotal");
            if (cycleTotalElement) {
              cycleTotalElement.textContent = cycleTotal;
            }
            const value = parseInt(element.value) || 0;
            const min = parseInt(element.min) || 0;
            const max = parseInt(element.max) || 999;
            updateButtonStates(id, value, min, max);
          });
        }
      });
      document.addEventListener("DOMContentLoaded", function () {
        const numberBtns = document.querySelectorAll(".number-btn");
        numberBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            const targetId = this.getAttribute("data-target");
            const input = document.getElementById(targetId);
            if (!input) return;
            const currentValue = parseInt(input.value) || 0;
            const min = parseInt(input.min) || 0;
            const max = parseInt(input.max) || 999;
            const isPlus = this.classList.contains("plus");
            let newValue = isPlus ? Math.min(currentValue + 1, max) : Math.max(currentValue - 1, min);
            input.value = newValue;
            const event = new Event("change", { bubbles: true });
            input.dispatchEvent(event);
            updateButtonStates(targetId, newValue, min, max);
          });
        });
        ["inhaleDuration", "holdDuration", "exhaleDuration", "cycleCount"].forEach((id) => {
          const input = document.getElementById(id);
          if (input) {
            const value = parseInt(input.value) || 0;
            const min = parseInt(input.min) || 0;
            const max = parseInt(input.max) || 999;
            updateButtonStates(id, value, min, max);
          }
        });
      });
      function updateButtonStates(inputId, value, min, max) {
        const minusBtn = document.querySelector(`[data-target="${inputId}"].minus`);
        const plusBtn = document.querySelector(`[data-target="${inputId}"].plus`);
        if (minusBtn) minusBtn.disabled = value <= min;
        if (plusBtn) plusBtn.disabled = value >= max;
      }
      document.addEventListener("DOMContentLoaded", () => {
        preparePhasePaths();
        setBallPositionOnPath(phaseDefs[0].path, 0);
        updateBreathingText("{% trans 'Hazır' %}", true);
        updateDurationsFromInputs();
        resetCycleCounter();
        showCycleCounter(false);
        window.addEventListener("resize", () => {
          if (!isRunning) {
            preparePhasePaths();
            setBallPositionOnPath(phaseDefs[0].path, 0);
          }
        });
      });
      // ---- TEMA MODU (iyi-dark) ----
      function applyIyiDark() {
        if (localStorage.getItem("iyiDark") === "on") {
          document.body.classList.add("iyi-dark");
        } else {
          document.body.classList.remove("iyi-dark");
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        applyIyiDark();
        var btnOn = document.getElementById("iyiDarkOn");
        var btnOff = document.getElementById("iyiDarkOff");
        if (btnOn && btnOff) {
          btnOn.onclick = function () {
            localStorage.setItem("iyiDark", "on");
            applyIyiDark();
          };
          btnOff.onclick = function () {
            localStorage.setItem("iyiDark", "off");
            applyIyiDark();
          };
        }
      });
      // ---- TEMA MODU (light/dark toggle) ----
      function applyThemeFromStorage() {
        const theme = localStorage.getItem("themeMode") || "light";
        if (theme === "dark") {
          document.body.classList.add("dark-mode");
          try {
            document.getElementById("darkModeBtn").classList.add("active");
            document.getElementById("lightModeBtn").classList.remove("active");
          } catch (e) {}
        } else {
          document.body.classList.remove("dark-mode");
          try {
            document.getElementById("lightModeBtn").classList.add("active");
            document.getElementById("darkModeBtn").classList.remove("active");
          } catch (e) {}
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        applyThemeFromStorage();
        const lightBtn = document.getElementById("lightModeBtn");
        const darkBtn = document.getElementById("darkModeBtn");
        if (lightBtn) lightBtn.addEventListener("click", function () {
            localStorage.setItem("themeMode", "light");
            applyThemeFromStorage();
          });
        if (darkBtn) darkBtn.addEventListener("click", function () {
            localStorage.setItem("themeMode", "dark");
            applyThemeFromStorage();
          });
      });
      // ---- RESPONSIVE REDIRECT ----
      function redirectIfSmallScreen() {
        if (
          window.innerWidth < 1300 &&
          !window.location.pathname.includes("responsive.html")
        ) {
          localStorage.setItem(
            "lastPage",
            window.location.pathname + window.location.search
          );
          window.location.href = "{% url 'responsive' %}";
        }
      }
      redirectIfSmallScreen();
      window.addEventListener("resize", redirectIfSmallScreen);
      // Bildirim popup davranışı ortak include içinde
      // ---- DİL DEĞİŞTİRME SİSTEMİ ----
      function applyLanguage(lang) {
        localStorage.setItem('selectedLanguage', lang);
        if (typeof translatePage === 'function') {
          translatePage(lang);
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        const lang = localStorage.getItem('selectedLanguage') || 'tr';
        applyLanguage(lang);
        const langTrBtn = document.getElementById('langTrBtn');
        const langEnBtn = document.getElementById('langEnBtn');
        if(langTrBtn) langTrBtn.onclick = function() { applyLanguage('tr'); };
        if(langEnBtn) langEnBtn.onclick = function() { applyLanguage('en'); };
      });
    </script>
    
  </body>
</html>
