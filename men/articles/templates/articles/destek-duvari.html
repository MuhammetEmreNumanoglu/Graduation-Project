{% load static %} {% load i18n %}

<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Destek Duvarı</title>
    <link rel="icon" href="{% static 'iyihisset.png' %}" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/responsive-sidebar.css' %}" />
    <link rel="stylesheet" href="{% static 'css/global-font-size.css' %}" />
    <style>
      :root {
        --primary-color: #6c3eb4;
        --secondary-color: #8ca6db;
        --accent-color: #b993d6;
        --background-light: #f9f9f9;
        --text-primary: #2c3e50;
        --text-secondary: #7f8c8d;
        --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
        --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
        --border-radius: 20px;
        --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --heart-color: #e74c3c;
        --heart-color-light: #ff6b6b;
      }

      body {
        background: linear-gradient(135deg, #b993d6 0%, #8ca6db 100%);
        min-height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        font-family: "Inter", sans-serif;
      }

      .sidebar-container {
        width: 400px;
        min-width: 400px;
        max-width: 400px;
        flex-shrink: 0;
        z-index: 2;
        background: #fff;
      }

      

      .sidebar-logo {
        width: 48px;
        height: 48px;
        object-fit: contain;
        border-radius: 12px;
        background: #f7f8fa;
        box-shadow: 0 2px 8px rgba(79, 82, 186, 0.08);
      }

      .sidebar-nav {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .sidebar-nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
        transition: var(--transition-smooth);
        padding: 8px 16px;
        border-radius: 10px;
        background: #f3eaff;
      }

      .sidebar-nav a:hover {
        color: var(--primary-color);
        background: #b993d6;
        color: white;
      }

      .sidebar-nav a.active {
        color: white;
        background: var(--primary-color);
      }

      .sidebar-user {
        padding: 24px;
        border-bottom: 1px solid rgba(139, 92, 246, 0.1);
        display: flex;
        align-items: center;
        gap: 16px;
        background: rgba(255, 255, 255, 0.8);
        flex-shrink: 0;
      }

      .user-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 1.5rem;
        box-shadow: var(--shadow-soft);
      }

      .user-info h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
      }

      .user-info p {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin: 0;
      }

      .sidebar-menu {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow-y: auto;
        min-height: 0;
      }

      .sidebar-menu::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar-menu::-webkit-scrollbar-track {
        background: rgba(139, 92, 246, 0.05);
        border-radius: 3px;
      }

      .sidebar-menu::-webkit-scrollbar-thumb {
        background: rgba(139, 92, 246, 0.2);
        border-radius: 3px;
      }

      .sidebar-menu::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 92, 246, 0.3);
      }

      .menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: var(--transition-smooth);
        cursor: pointer;
        border-radius: 12px;
        border: 1px solid transparent;
        white-space: nowrap;
      }

      .menu-item:hover {
        background: rgba(139, 92, 246, 0.1);
        color: var(--primary-color);
        border-color: rgba(139, 92, 246, 0.2);
        transform: translateX(4px);
      }

      .menu-item.active {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        box-shadow: var(--shadow-soft);
        border-color: transparent;
      }

      .menu-item .material-symbols-outlined {
        font-size: 1.2rem;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .tasks-section {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
        border: 1px solid rgba(139, 92, 246, 0.1);
      }

      /* Meditasyon sayfası ile aynı sidebar-title görünümü */
      .sidebar-block.sidebar-title {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        padding: 24px;
        margin-bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
        max-height: 100vh;
        overflow-y: auto;
        overflow-x: hidden;
      }
      .sidebar-tasks {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        min-height: 0;
      }

      .tasks-section h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tasks-section h3::before {
        content: "";
        width: 4px;
        height: 20px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 2px;
      }

      .task-item {
        background: rgba(139, 92, 246, 0.1);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 500;
        box-shadow: 0 1px 4px rgba(140, 82, 255, 0.04);
        border: 1px solid transparent;
        transition: var(--transition-smooth);
        cursor: pointer;
      }

      .task-item:hover {
        background: rgba(139, 92, 246, 0.15);
        box-shadow: 0 2px 8px rgba(140, 82, 255, 0.09);
        border-color: rgba(139, 92, 246, 0.2);
        transform: translateX(4px);
      }

      .task-item:last-child {
        margin-bottom: 0;
      }

      .main-content {
        flex: 1;
        
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: var(--transition-smooth);
        padding: 48px 24px 24px 24px;
        min-height: 100vh;
        overflow-y: auto;
        justify-content: center;
      }

      .support-wall-container {
        max-width: 800px;
        margin: 0 auto;
        width: 100%;
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
        text-align: center;
        margin-bottom: 2rem;
        text-shadow: 0 2px 4px rgba(108, 62, 180, 0.1);
      }

      /* Story Form Card */
      .story-form-card {
        background: var(--background-light);
        border-radius: var(--border-radius);
        padding: 2.5rem;
        margin-bottom: 3rem;
        box-shadow: var(--shadow-soft);
        border: none;
        transition: var(--transition-smooth);
      }

      .story-form-card:hover {
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .form-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .story-textarea {
        width: 100%;
        min-height: 120px;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.6;
        resize: vertical;
        transition: var(--transition-smooth);
        background: white;
      }

      .story-textarea:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(185, 147, 214, 0.1);
      }

      .share-button {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 32px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-smooth);
        box-shadow: 0 4px 16px rgba(108, 62, 180, 0.2);
        width: 100%;
      }

      .share-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(108, 62, 180, 0.3);
      }

      .share-button:active {
        transform: translateY(0);
      }

      /* Story Cards */
      .story-card {
        background: white;
        border-radius: var(--border-radius);
        padding: 2rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-soft);
        transition: var(--transition-smooth);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .story-card:hover {
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
      }

      .story-content {
        font-size: 1.1rem;
        line-height: 1.7;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        word-wrap: break-word;
      }

      .story-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 1rem;
        border-top: 1px solid #f1f3f4;
      }

      .story-timestamp {
        font-size: 0.9rem;
        color: var(--text-secondary);
        font-weight: 500;
      }

      /* Enhanced Like Button */
      .like-button-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .like-button {
        background: #fff;
        border: 1.5px solid #e2e2e2;
        border-radius: 50px;
        padding: 6px 18px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        color: #6c3eb4;
      }

      .like-button .like-icon {
        color: #bbb;
        transition: color 0.2s;
      }

      .like-button.liked .like-icon {
        color: #e74c3c !important;
      }

      .like-button.liked {
        background: #ffe6ea !important;
        border-color: #e74c3c !important;
        color: #e74c3c !important;
      }

      .like-icon {
        font-size: 1.2rem;
        transition: var(--transition-smooth);
      }

      .like-button:hover .like-icon {
        transform: scale(1.1);
      }

      .likes-count {
        font-weight: 600;
        min-width: 1.5rem;
        text-align: center;
      }

      /* Floating Hearts Animation */
      .floating-hearts {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
      }

      .floating-heart {
        position: absolute;
        color: var(--heart-color);
        font-size: 1rem;
        animation: floatUp 1.2s ease-out forwards;
        opacity: 0;
      }

      @keyframes floatUp {
        0% {
          opacity: 0;
          transform: translateY(0) scale(0.5);
        }
        20% {
          opacity: 1;
          transform: translateY(-10px) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-60px) scale(0.8);
        }
      }

      @keyframes heartBeat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
      }

      /* Pagination */
      .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
        padding: 1.5rem;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-soft);
      }

      .pagination-button {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        border: none;
        border-radius: 50px;
        padding: 10px 20px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition-smooth);
        box-shadow: 0 4px 15px rgba(108, 62, 180, 0.2);
        text-decoration: none !important;
        border-bottom: none !important;
      }

      .pagination-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(108, 62, 180, 0.3);
      }

      .pagination-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .page-info {
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 500;
      }

      .current-page {
        font-weight: 700;
        color: var(--primary-color);
      }

      /* Responsive Design */
      @media (max-width: 991px) {
        body { flex-direction: column; }
        .sidebar-container { width: 100vw; min-width: 0; max-width: 100vw; }
        .main-content { margin-left: 0; padding: 24px 16px; }
      }

      @media (max-width: 600px) {
        .page-title {
          font-size: 2rem;
        }

        .story-form-card {
          padding: 1.5rem;
        }

        .story-card {
          padding: 1.5rem;
        }

        .story-footer {
          flex-direction: column;
          align-items: flex-start;
          gap: 1rem;
        }

        .like-button {
          align-self: flex-end;
        }

        .pagination-container {
          flex-direction: column;
          gap: 1rem;
        }
      }

      .sidebar-title-text {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 18px;
        width: 100%;
        text-align: left;
        position: relative;
      }
      .sidebar-title-text::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 40px;
        height: 3px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 2px;
      }
      .sidebar-tasks {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
      }
      .sidebar-task-item {
        background: rgba(139, 92, 246, 0.1);
        border-radius: 12px;
        padding: 16px;
        font-size: 1rem;
        color: var(--text-primary);
        font-weight: 500;
        box-shadow: 0 1px 4px rgba(140, 82, 255, 0.04);
        border: 1px solid transparent;
        transition: var(--transition-smooth);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .sidebar-task-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }
      .sidebar-task-item:hover {
        background: rgba(139, 92, 246, 0.15);
        box-shadow: 0 2px 8px rgba(140, 82, 255, 0.09);
        border-color: rgba(139, 92, 246, 0.2);
        transform: translateX(4px);
      }
      .sidebar-task-item:hover::before {
        left: 100%;
      }

      /* Dark Mode Styles */
      body.dark-mode {
        background: linear-gradient(135deg, #232526 0%, #414345 100%) !important;
        color: #f1f1f1 !important;
      }

      body.dark-mode .main-content {
        background: #181820 !important;
        color: #e0e0e0 !important;
      }

      body.dark-mode .page-title,
      body.dark-mode .page-subtitle {
        color: #e0e0e0 !important;
      }

      body.dark-mode .sidebar-container {
        background: rgba(35, 35, 35, 0.95) !important;
        color: #f1f1f1 !important;
      }

      

      body.dark-mode .sidebar-nav a {
        color: #b0b0b0 !important;
        background: #333 !important;
      }

      body.dark-mode .sidebar-nav a:hover {
        color: #f1f1f1 !important;
        background: #555 !important;
      }

      body.dark-mode .sidebar-nav a.active {
        color: #f1f1f1 !important;
        background: #6a4c9c !important;
      }

      body.dark-mode .sidebar-user {
        background: rgba(45, 45, 45, 0.8) !important;
        border-bottom-color: #555 !important;
      }

      body.dark-mode .user-info h3 {
        color: #f1f1f1 !important;
      }

              body.dark-mode .user-info p {
          color: #b0b0b0 !important;
          font-size: 0.9rem !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
          max-width: 200px !important;
        }

      body.dark-mode .sidebar-title-text {
        color: #8c73b8 !important;
      }
      body.dark-mode .sidebar-block.sidebar-title {
            background: #181818 !important;
            color: #f8f8ff !important;
            border-color: #29293a !important;
        }
        body.dark-mode .sidebar-block.sidebar-title * {
            color: #f8f8ff !important;
        }
      body.dark-mode .sidebar-task-item {
        background: rgba(139, 92, 246, 0.2) !important;
        color: #f1f1f1 !important;
        border-color: #555 !important;
      }

      body.dark-mode .sidebar-task-item:hover {
        background: rgba(139, 92, 246, 0.3) !important;
        border-color: #8c73b8 !important;
      }

      body.dark-mode .support-container {
        background: rgba(45, 45, 45, 0.95) !important;
        border-color: #555 !important;
        color: #f1f1f1 !important;
      }

      body.dark-mode .support-card {
        background: linear-gradient(160deg, rgba(45, 45, 45, 0.98) 0%, rgba(35, 35, 35, 0.92) 100%) !important;
        border-color: #555 !important;
        color: #f1f1f1 !important;
      }

      body.dark-mode .support-card:hover {
        border-color: #6a4c9c !important;
      }

      body.dark-mode .support-title {
        color: #f1f1f1 !important;
      }

      body.dark-mode .support-description {
        color: #b0b0b0 !important;
      }

      body.dark-mode .support-category {
        background: #333 !important;
        color: #8c73b8 !important;
      }


      body.dark-mode input,
      body.dark-mode textarea,
      body.dark-mode select {
        background: #333 !important;
        color: #f1f1f1 !important;
        border-color: #555 !important;
      }

      body.dark-mode .card,
      body.dark-mode .box,
      body.dark-mode .panel {
        background: #2c2c2c !important;
        color: #f1f1f1 !important;
        border-color: #444 !important;
      }

      body.dark-mode a {
        color: #8c73b8 !important;
      }

      body.dark-mode .btn {
        background: #6a4c9c !important;
        color: #f1f1f1 !important;
      }

      body.dark-mode .story-form-card {
        background: #232323 !important;
      }
      body.dark-mode .pagination-container {
        background:#232323 !important;
      }
      body.dark-mode .story-form-card,
      body.dark-mode .story-form-card *,
      body.dark-mode .pagination-container,
      body.dark-mode .pagination-container * {
        color: #f8f8ff !important;
      }

      body.dark-mode .story-card {
        background: #2c2c2c !important;
        color: #f8f8ff !important;
      }
      body.dark-mode .story-content,
      body.dark-mode .story-footer,
      body.dark-mode .like-button,
      body.dark-mode .like-icon {
        color: #f8f8ff !important;
      }
      body.dark-mode .like-button {
        background: #2a2040 !important;
        border-color: #3a2a5d !important;
        color: #f8f8ff !important;
      }
      .like-button.liked .like-icon {
        color: #ff6b81 !important;
      }
      .like-button.liked {
        border-color: #ff6b81 !important;
        color: #ff6b81 !important;
      }
      .notification-bell {
        position: fixed;
        top: 32px;
        right: 48px;
        z-index: 1200;
        background: linear-gradient(135deg, #a084e8 0%, #6c3eb4 100%);
        border-radius: 50%;
        padding: 12px;
        border: none;
        cursor: pointer;
        font-size: 2.2rem;
        color: #fff;
        box-shadow: 0 4px 16px rgba(139, 92, 246, 0.13);
        transition: color 0.2s, background 0.2s, box-shadow 0.2s, transform 0.18s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .notification-bell:hover {
        transform: scale(1.08);
      }
      .notification-popup {
        display: block;
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        position: fixed;
        top: 72px;
        right: 48px;
        width: 340px;
        max-height: 270px;
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(139, 92, 246, 0.18);
        border: 1.5px solid #ece6fa;
        z-index: 1300;
        overflow-y: auto;
        padding: 0;
        transform: translateY(-20px);
        transition: opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1), visibility 0.35s;
      }
      .notification-popup.active {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateY(0);
      }
      .notification-popup .popup-title {
        font-weight: 700;
        font-size: 1.2rem;
        padding: 18px 24px 8px 24px;
        color: #8b5cf6;
        border-bottom: 1px solid #ece6fa;
      }
      .notification-list {
        list-style: none;
        margin: 0;
        padding: 0 0 8px 0;
        max-height: 340px;
        overflow-y: auto;
      }
      .notification-item {
        padding: 16px 24px;
        border-bottom: 1px solid #f3eaff;
        font-size: 1rem;
        color: #232526;
        background: none;
      }
      .notification-item:last-child {
        border-bottom: none;
      }
      @media (max-width: 600px) {
        .notification-bell {
          top: 16px;
          right: 12px;
          padding: 8px;
          font-size: 1.5rem;
        }
        .notification-popup {
          top: 48px;
          right: 8px;
          width: 95vw;
          min-width: 0;
          max-width: 98vw;
        }
      }
      /* Dark mode için */
      body.dark-mode .notification-bell {
        background: linear-gradient(135deg, #6c3eb4 0%, #3a2a5d 100%) !important;
        color: #fff !important;
        box-shadow: 0 8px 32px rgba(80, 60, 120, 0.32);
      }
      body.dark-mode .notification-bell:hover {
        background: linear-gradient(135deg, #6c3eb4 0%, #3a2a5d 100%) !important;
        color: #fff !important;
        box-shadow: 0 8px 32px rgba(80, 60, 120, 0.32);
      }
      body.dark-mode .notification-popup {
        background: #232323 !important;
        color: #e0e0e0 !important;
        border-color: #333 !important;
      }
      body.dark-mode .notification-popup .popup-title {
        color: #c084fc !important;
        border-bottom: 1px solid #333 !important;
      }
      body.dark-mode .notification-item {
        color: #e0e0e0 !important;
        border-bottom: 1px solid #333 !important;
      }
    /* Dark Mode — meditasyon ile aynı */
    body.dark-mode { background: #181818 !important; color: #e0e0e0 !important; }
    body.dark-mode .main-content { background: #232323 !important; color: #e0e0e0 !important; }
    body.dark-mode .page-title, body.dark-mode .page-subtitle { color: #e0e0e0 !important; }
    body.dark-mode .sidebar-container { background: #1a1a1a !important; border-color: #333 !important; }
    
    body.dark-mode .sidebar-nav a { background: #333 !important; color: #e0e0e0 !important; }
    body.dark-mode .sidebar-nav a:hover { background: #4a4a4a !important; color: #fff !important; }
    body.dark-mode .sidebar-nav a.active { background: var(--primary-color) !important; color: #fff !important; }
    body.dark-mode .sidebar-block.sidebar-title { background: #181818 !important; color: #f8f8ff !important; border-color: #29293a !important; }
    body.dark-mode .sidebar-block.sidebar-title * { color: #f8f8ff !important; }
    body.dark-mode .sidebar-user { background: #181818 !important; border-color: #333 !important; }
    body.dark-mode .user-info h3 { color: #e0e0e0 !important; }
            body.dark-mode .user-info p { 
          color: #b0b0b0 !important; 
          font-size: 0.9rem !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
          max-width: 200px !important;
        }
    body.dark-mode .sidebar-task-item { background: #333 !important; color: #e0e0e0 !important; border-color: #444 !important; }
    body.dark-mode .sidebar-task-item:hover { background: #444 !important; color: #fff !important; border-color: var(--primary-color) !important; }
    body.dark-mode .sidebar-title-text { color: var(--primary-color) !important; }
    body.dark-mode .menu-item { color: #e0e0e0 !important; }
    body.dark-mode .menu-item:hover { background: #333 !important; color: var(--primary-color) !important; }
    body.dark-mode .menu-item.active { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important; color: #fff !important; }

      /* Sidebar background overrides */
      body.dark-mode .sidebar-header,
      body.dark-mode .sidebar-user,
      body.dark-mode .sidebar-menu { background: #181818 !important; }

      /* Ensure dark mode main content background */
      body.dark-mode .main-content { background: #23232354 !important; }
    </style>
  </head>
  <body>
 <!-- Sidebar -->
 <div class="sidebar-container" id="sidebarContainer">
  <div class="sidebar-header">
    <img src="{% static 'iyihisset.png' %}" alt="Logo" class="sidebar-logo" />
    <div class="sidebar-nav">
      <a href="{% url 'anasayfa' %}">{% trans "Ana Sayfa" %}</a>
      <a href="{% url 'dashboard' %}">{% trans "İyi Hisset" %}</a>
      <a href="{% url 'profile-management' %}">{% trans "Profil Yönetimi" %}</a>
    </div>
  </div>
  <div class="sidebar-user">
    <div class="user-avatar">
      <img src="{{profilePic.profile_pic.url}}" alt="" />
    </div>
    <div class="user-info">
      <h3>{{ user.username.title }}</h3>
      <p>{{ user.email }}</p>
    </div>
  </div>
  <div class="sidebar-menu">
    {% include 'articles/gorevlerim.html' %}
  </div>
</div>

{% include 'articles/includes/notifications.html' %}

<main class="main-content">
  <div class="support-wall-container">
    <h1 class="page-title">{% trans "Destek Duvarı" %}</h1>
    <!-- Hikaye Paylaşma Formu -->
    <div class="story-form-card">
      <h2 class="form-title">{% trans "Hikayeni Paylaş" %}</h2>
      <form id="storyForm" method="POST">
        {% csrf_token %}
        <textarea class="story-textarea" id="storyText" name="storyText" placeholder="{% trans 'Hikayeni buraya yazabilirsin...' %}" minlength="4" required></textarea>
        <button type="submit" class="share-button mt-3">{% trans "Paylaş" %}</button>
      </form>
    </div>
    <!-- Hikayeler Listesi -->
    <div id="storiesList">
      {% for msg in messages %}
        <div class="story-card" style="position:relative;" data-id="{{ msg.id }}" data-likes="{{ msg.likes }}">
          <div class="story-content">{{ msg.content }}</div>
          <div class="story-footer" style="display:flex;justify-content:space-between;align-items:flex-end;">
            <div class="story-timestamp" style="font-size:0.9em; color:#666; font-weight:400;align-self:flex-start;min-width:140px;">{{ msg.created_at|date:'d.m.Y H:i' }}</div>
            <div class="like-button-container">
              <button class="like-button{% if msg.id in liked_messages %} liked{% endif %}" data-id="{{ msg.id }}">
                <span class="like-icon material-symbols-outlined">{% if msg.id in liked_messages %}favorite{% else %}favorite_border{% endif %}</span>
                <span class="likes-count">{{ msg.likes }}</span>
              </button>
              <div class="floating-hearts"></div>
            </div>
          </div>
        </div>
      {% empty %}
        <div style="text-align:center; color:#aaa;">{% trans "Henüz hiç mesaj yok." %}</div>
      {% endfor %}
    </div>
    <!-- Sayfalama -->
    {% if messages.has_other_pages %}
    <div class="pagination-container" style="margin-top:32px;display:flex;justify-content:center;align-items:center;gap:16px;">
      {% if messages.has_previous %}
        <a href="?page={{ messages.previous_page_number }}" class="pagination-button">&laquo; {% trans "Önceki" %}</a>
      {% endif %}
      <span style="font-size:1.1em; color:#888;">{% trans "Sayfa" %} {{ messages.number }} / {{ messages.paginator.num_pages }}</span>
      {% if messages.has_next %}
        <a href="?page={{ messages.next_page_number }}" class="pagination-button">{% trans "Sonraki" %} &raquo;</a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</main>

<!-- JS dosyaları -->
<script src="{% static 'js/responsive-sidebar.js' %}"></script>
<script src="{% static 'js/font-size-manager.js' %}"></script>
<script src="{% static 'js/lang.js' %}"></script>

<!-- Bildirim Popup: davranış ortak include içinde -->
<!-- Like-Button (Sıralama yok!) -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".like-button").forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        const storyId = btn.getAttribute("data-id");
        fetch("{% url 'like_story' %}", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: "story_id=" + storyId,
        })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            if (data.liked) {
              btn.classList.add("liked");
              btn.querySelector(".like-icon").textContent = "favorite";
            } else {
              btn.classList.remove("liked");
              btn.querySelector(".like-icon").textContent = "favorite_border";
            }
            btn.querySelector(".likes-count").textContent = data.likes;
            // SIRALAMA YOK! Sadece like sayısı güncellenir
          }
        });
      });
    });

    // Sadece sayfa ilk yüklenince sıralama yap:
    sortStoriesByLikes();
    function sortStoriesByLikes() {
      const list = document.getElementById("storiesList");
      const items = Array.from(list.querySelectorAll(".story-card"));
      items.sort((a, b) => {
        const aLike = parseInt(a.getAttribute("data-likes") || "0", 10);
        const bLike = parseInt(b.getAttribute("data-likes") || "0", 10);
        if (bLike !== aLike) return bLike - aLike;
        return parseInt(b.getAttribute("data-id")) - parseInt(a.getAttribute("data-id"));
      });
      items.forEach(item => list.appendChild(item));
    }
  });
</script>
<!-- Tema -->
<script>
  function applyThemeFromStorage() {
    const theme = localStorage.getItem('themeMode') || 'light';
    if(theme === 'dark') {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }
  document.addEventListener('DOMContentLoaded', applyThemeFromStorage);
</script>
<!-- Küçük ekran yönlendirme -->
<script>
  function redirectIfSmallScreen() {
    if (
      window.innerWidth < 1300 &&
      !window.location.pathname.includes("responsive.html")
    ) {
      localStorage.setItem(
        "lastPage",
        window.location.pathname + window.location.search
      );
      window.location.href = "{% url 'responsive' %}";
    }
  }
  redirectIfSmallScreen();
  window.addEventListener("resize", redirectIfSmallScreen);
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    if (typeof initializeLanguage === "function") {
      initializeLanguage();
    }
  });
</script>
  </body>
</html>
